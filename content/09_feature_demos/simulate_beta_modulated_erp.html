<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HNN Textbook</title>
    <!-- <base href="/website_redesign/"> -->
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/styles.css">
</head>
<body>

	<div id="mySidebar" class="sidebar">
		<div class="navbar-header">
		<a>
			Human Neocortical Neurosolver
		</a>
		<br>
			<svg class="collapse-icon" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
				<path d="M9 9H4v1h5V9z"/>
				<path fill-rule="evenodd" clip-rule="evenodd" d="M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"/>
			</svg>
		</div>
		<a href="/website_redesign/content/preface.html">Preface</a>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				1. Getting Started
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/01_getting_started/challenge.html">1.1 Introducing the Human Neocortical Neurosolver</a>
				<a href="/website_redesign/content/01_getting_started/template_model.html">1.2 Template Model</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				2. Model Assumptions
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/03_model_assumptions/cortical_column_structure.html">2.1 Cortical Column Structure</a>
				<a href="/website_redesign/content/03_model_assumptions/primary_electric_currents.html">2.2 Primary Electrical Currents</a>
				<a href="/website_redesign/content/03_model_assumptions/neurons_morphology_and_physiology.html">2.3 Neurons: Morphology and Physiology</a>
				<a href="/website_redesign/content/03_model_assumptions/synaptic_connectivity.html">2.4 Synaptic Connectivity</a>
				<a href="/website_redesign/content/03_model_assumptions/evoked_and_rhythmic_driving_inputs.html">2.5 Evoked and Rhythmic Driving Inputs</a>
				<a href="/website_redesign/content/03_model_assumptions/tonic_and_noisy_driving_inputs.html">2.6 Tonic and Noisy Driving Inputs</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				3. Simulating ERPs
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/05_erps/erps_in_gui.html">3.1 GUI Tutorial of ERPs Simulation</a>
				<a href="/website_redesign/content/05_erps/hnn_core.html">3.2 API Tutorial of ERPs Simulation</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				4. Simulating Alpha/Beta Rhythms
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/06_alpha_beta/gui.html">4.1 GUI Tutorial of Alpha/Beta Rhythms</a>
				<a href="/website_redesign/content/06_alpha_beta/api.html">4.2 API Tutorial of Alpha/Beta Rhythms</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				5. Simulating Gamma Rhythms
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/07_gamma/gamma_in_gui.html">5.1 GUI Tutorial of Gamma Rhythms</a>
				<a href="/website_redesign/content/07_gamma/gamma_in_api.html">5.2 API Tutorial of Gamma Rhythms</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				6. From Data to Simulation
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/08_data_to_simulation/from_meg_to_hnn.html">6.1 From MEG sensor-space data to HNN simulation</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				7. Feature Demos
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/09_feature_demos/plot_firing_pattern.html">7.1 Plot Firing Pattern</a>
				<a href="/website_redesign/content/09_feature_demos/record_and_plot_extracellular_potentials.html">7.2 Record & Plot Extracellular Potentials</a>
				<a href="/website_redesign/content/09_feature_demos/modifying_local_connectivity.html">7.3 Modifying Local Connectivity</a>
				<a href="/website_redesign/content/09_feature_demos/animating_hnn_simulations.html">7.4 Animating HNN Simulations</a>
				<a href="/website_redesign/content/09_feature_demos/batch_simulation.html">7.5 Batch Simulation</a>
				<a href="/website_redesign/content/09_feature_demos/simulate_beta_modulated_erp.html">7.6 Simulate Beta-modulated ERP</a>
				<a href="/website_redesign/content/09_feature_demos/use_mpi_backend_for_parallelization.html">7.7 Use MPI Backend for Parallelization</a>
				<a href="/website_redesign/content/09_feature_demos/optimize_simulated_evoked_response_parameters.html">7.8 Optimize simulated evoked response parameters</a>
				<a href="/website_redesign/content/09_feature_demos/optimize_simulated_rhythmic_response_parameters.html">7.9 Optimize simulated rhythmic response parameters</a>
			</div>
		</div>
	<div style='height: 30px;'></div>
	</div>

<div id="main">
    <div class="topbar">

        <!-- Topbar menu -->
        <div class="menu-container">
            <div class="menu-icons">
                <button class="openbtn" onclick="toggleNav()">
                    ☰
                </button>
                <a href="" class="home-link">
                    <div class="home-icon-container">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24" 
                            height="24"
                            viewBox="0 0 24 24" 
                            class="home-icon">
                            <path
                                d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"
                            />
                        </svg>
                    </div>
                </a>
                <button class="theme-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"></path>
                    </svg>
                </button>
                <div class="dropdown">
                    <button 
                        id="dropdownButton" 
                        class="dropdown-button">
                            <img
                                src="/website_redesign/content/assets/icons/fontsize.png"
                                alt="fontsize"
                            />
                    </button>
                    <div class="dropdown-content">
                        <button 
                            class="fontsize-btn" 
                            onclick="decreaseFontSize()">
                            <img
                                src="/website_redesign/content/assets/icons/fontminus.png"
                                alt="fontminus"
                            />
                        </button>
                        <button 
                            class="fontsize-btn" 
                            onclick="increaseFontSize()">
                            <img
                                src="/website_redesign/content/assets/icons/fontplus.png"
                                alt="fontplus"
                            />
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Topbar image -->
        <div class="topbar-logo-container">
            <img 
                id="topbar-logo"
                src="https://hnn.brown.edu/wp-content/uploads/hnn-medium.png"
            />
        </div>

        <!-- Right side of topbar -->
        <div class="socials-container">
            <div class="social-icons">
                <a 
                    href="https://github.com/jonescompneurolab/hnn-core" 
                    target="_blank" 
                    aria-label="GitHub">
                    <img 
                        src="/website_redesign/content/assets/icons/github.png"
                        alt="GitHub">
                </a>
                <a 
                    href="https://bsky.app/profile/hnnsolver.bsky.social" 
                    target="_blank"
                    aria-label="BlueSky">
                    <img 
                        src="/website_redesign/content/assets/icons/bluesky.png"
                        alt="BlueSky">
                </a>
                <a 
                    href="https://www.linkedin.com/company/human-neocortical-neurosolver/" 
                    target="_blank"
                    aria-label="LinkedIn">
                    <img 
                        src="/website_redesign/content/assets/icons/linkedin.png"
                        alt="LinkedIn">
                </a>
            </div>
        </div>
    </div>

    <div id="content-wrapper">
    <div id="content">

<!--
# Title: 7.6 Simulate Beta-modulated ERP
# Updated: 2025-02-04
#
# Contributors:
    # Dylan Daniels
-->
<div class='markdown-cell'>
    <h1>7.6: Simulate Beta-modulated ERP</h1>
<p>This example demonstrates how event related potentials (ERP) are
modulated by prestimulus beta events. Specifically, this example
reproduces Figure 5 from (Law et al. 2021). To be consistent with the
publication, the default network connectivity is altered. These
modifications demonstrate a potential mechanism by which transient beta
activity in the neocortex can suppress the perceptibility of sensory
input. This suppression depends on the timing of the beta event, and the
incoming sensory information.</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        # Authors: Nick Tolley <nicholas_tolley@brown.edu>

from hnn_core import simulate_dipole, law_2021_model, jones_2009_model
from hnn_core.viz import plot_dipole
    </code>
</div>
<div class='markdown-cell'>
    <p>We begin by instantiating the network model from (Law et
al. 2021):</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        net = law_2021_model()
    </code>
</div>
<div class='markdown-cell'>
    <p>The Law 2021 model is based on the network model described in (Jones
et al. 2009) with several important modifications. One of the most
significant changes is substantially increasing the rise and fall time
constants of GABAb-conductances on L2 and L5 pyramidal. Another
important change is the removal of calcium channels from basal dendrites
and soma of L5 pyramidal cells specifically. We can inspect these
properties with the <code>net.cell_types</code> attribute which contains
information on the biophysics and geometry of each cell.</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        net_jones = jones_2009_model()

jones_rise = net_jones.cell_types['L5_pyramidal'].synapses['gabab']['tau1']
law_rise = net.cell_types['L5_pyramidal'].synapses['gabab']['tau1']
print(f'GABAb Rise (ms): {jones_rise} -> {law_rise}')

jones_fall = net_jones.cell_types['L5_pyramidal'].synapses['gabab']['tau2']
law_fall = net.cell_types['L5_pyramidal'].synapses['gabab']['tau2']
print(f'GABAb Fall (ms): {jones_fall} -> {law_fall}\n')

print('Apical Dendrite Channels:')
print(net.cell_types['L5_pyramidal'].sections['apical_1'].mechs.keys())
print("\nBasal Dendrite Channels ('ca' missing):")
print(net.cell_types['L5_pyramidal'].sections['basal_1'].mechs.keys())
    </code>
</div>
<div class='markdown-cell'>
    <p>A major change to the Jones 2009 model is the addition of a
Martinotti-like recurrent tuft connection (Silberberg and Markram 2007).
This new connection originates from L5 basket cells, and provides GABAa
inhibition on the distal dendrites of L5 pyramidal cells.</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        print('Recurrent Tuft Connection')
print(net.connectivity[16])
    </code>
</div>
<div class='markdown-cell'>
    <p>The remaining changes to the connectivity was the removal of an
L2_basket -&gt; L5_pyramidal GABAa connection, and replacing it with
GABAb.</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        print('New GABAb connection')
print(net.connectivity[15])

print('\nConnection Removed from Law Model')
print(net_jones.connectivity[10])
    </code>
</div>
<div class='markdown-cell'>
    <p>To demonstrate sensory depression, we will add the drives necessary
to generate and ERP similar to our <a
href="https://dylansdaniels.github.io/website_redesign/content/05_erps/hnn_core.html">ERP
example</a>, but modified to reflect the parameters used in (Law et
al. 2021). Specifically, we are considering the case where a tactile
stimulus is delivered at 150 ms. 25 ms later, the first input to sensory
cortex arrives as a proximal drive to the cortical column. Proximal
drive corresponds to projections from the direct thalamic nuclei. This
is followed by one <code>distal</code> drive representing projections
from indirect thalamic nuclei, and a final late proximal drive. It is
important to note that the parameter values for each are different from
previous examples of the evoked response. This reflects the altered
network dynamics due to the changes described above.</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        def add_erp_drives(net, stimulus_start):
    # Distal evoked drive
    weights_ampa_d1 = {'L2_basket': 0.0005, 'L2_pyramidal': 0.004,
                       'L5_pyramidal': 0.0005}
    weights_nmda_d1 = {'L2_basket': 0.0005, 'L2_pyramidal': 0.004,
                       'L5_pyramidal': 0.0005}
    syn_delays_d1 = {'L2_basket': 0.1, 'L2_pyramidal': 0.1,
                     'L5_pyramidal': 0.1}
    net.add_evoked_drive(
        'evdist1', mu=70.0 + stimulus_start, sigma=0.0, numspikes=1,
        weights_ampa=weights_ampa_d1, weights_nmda=weights_nmda_d1,
        location='distal', synaptic_delays=syn_delays_d1, event_seed=274)

    # Two proximal drives
    weights_ampa_p1 = {'L2_basket': 0.002, 'L2_pyramidal': 0.0011,
                       'L5_basket': 0.001, 'L5_pyramidal': 0.001}
    syn_delays_prox = {'L2_basket': 0.1, 'L2_pyramidal': 0.1,
                       'L5_basket': 1., 'L5_pyramidal': 1.}

    # all NMDA weights are zero; pass None explicitly
    net.add_evoked_drive(
        'evprox1', mu=25.0 + stimulus_start, sigma=0.0, numspikes=1,
        weights_ampa=weights_ampa_p1, weights_nmda=None,
        location='proximal', synaptic_delays=syn_delays_prox, event_seed=544)

    # Second proximal evoked drive. NB: only AMPA weights differ from first
    weights_ampa_p2 = {'L2_basket': 0.005, 'L2_pyramidal': 0.005,
                       'L5_basket': 0.01, 'L5_pyramidal': 0.01}
    # all NMDA weights are zero; omit weights_nmda (defaults to None)
    net.add_evoked_drive(
        'evprox2', mu=135.0 + stimulus_start, sigma=0.0, numspikes=1,
        weights_ampa=weights_ampa_p2, location='proximal',
        synaptic_delays=syn_delays_prox, event_seed=814)

    return net
    </code>
</div>
<div class='markdown-cell'>
    <p>A beta event is created by inducing simultaneous proximal and distal
drives. The input is just strong enough to evoke spiking in the L2
basket cells. This spiking causes GABAb mediated inhibition of the
network, and ultimately suppressed sensory detection.</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        def add_beta_drives(net, beta_start):
    # Distal Drive
    weights_ampa_d1 = {'L2_basket': 0.00032, 'L2_pyramidal': 0.00008,
                       'L5_pyramidal': 0.00004}
    syn_delays_d1 = {'L2_basket': 0.5, 'L2_pyramidal': 0.5,
                     'L5_pyramidal': 0.5}
    net.add_bursty_drive(
        'beta_dist', tstart=beta_start, tstart_std=0., tstop=beta_start + 50.,
        burst_rate=1., burst_std=10., numspikes=2, spike_isi=10,
        n_drive_cells=10, location='distal', weights_ampa=weights_ampa_d1,
        synaptic_delays=syn_delays_d1, event_seed=290)

    # Proximal Drive
    weights_ampa_p1 = {'L2_basket': 0.00004, 'L2_pyramidal': 0.00002,
                       'L5_basket': 0.00002, 'L5_pyramidal': 0.00002}
    syn_delays_p1 = {'L2_basket': 0.1, 'L2_pyramidal': 0.1,
                     'L5_basket': 1.0, 'L5_pyramidal': 1.0}

    net.add_bursty_drive(
        'beta_prox', tstart=beta_start, tstart_std=0., tstop=beta_start + 50.,
        burst_rate=1., burst_std=20., numspikes=2, spike_isi=10,
        n_drive_cells=10, location='proximal', weights_ampa=weights_ampa_p1,
        synaptic_delays=syn_delays_p1, event_seed=300)
    return net
    </code>
</div>
<div class='markdown-cell'>
    <p>We can now use our functions to create three distinct
simulations:</p>
<ol type="1">
<li>beta event only,</li>
<li>ERP only, and</li>
<li>beta event + ERP.</li>
</ol>

</div>
<div class='code-cell'>
    <code class='language-python'>
        beta_start, stimulus_start = 50.0, 125.0
net_beta = net.copy()
net_beta = add_beta_drives(net_beta, beta_start)

net_erp = net.copy()
net_erp = add_erp_drives(net_erp, stimulus_start)

net_beta_erp = net_beta.copy()
net_beta_erp = add_erp_drives(net_beta_erp, stimulus_start)
    </code>
</div>
<div class='markdown-cell'>
    <p>And finally we simulate. Note that the default simulation time has
been increased to 400 ms to observe the long time course over which beta
events can influence sensory input to the cortical column.</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        dpls_beta = simulate_dipole(net_beta, tstop=400)
    </code>
</div>
<div class='code-cell'>
    <code class='language-python'>
        dpls_erp = simulate_dipole(net_erp, tstop=400)
    </code>
</div>
<div class='code-cell'>
    <code class='language-python'>
        dpls_beta_erp = simulate_dipole(net_beta_erp, tstop=400)
    </code>
</div>
<div class='markdown-cell'>
    <p>By inspecting the activity during the beta event, we can see that
spiking occurs exclusively at 50 ms, the peak of the gaussian
distributed proximal and distal inputs. This spiking activity leads to
sustained GABAb mediated inhibition of the L2 and L5 pyrmaidal cells.
One effect of this inhibition is an asymmetric beta event with a long
positive tail.</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        import matplotlib.pyplot as plt
import numpy as np
fig, axes = plt.subplots(4, 1, sharex=True, figsize=(7, 7),
                         constrained_layout=True)
net_beta.cell_response.plot_spikes_hist(ax=axes[0], show=False)
axes[0].set_title('Beta Event Generation')
plot_dipole(dpls_beta, ax=axes[1], layer='agg', tmin=1.0, color='b', show=False)
net_beta.cell_response.plot_spikes_raster(ax=axes[2], show=False)
axes[2].set_title('Spike Raster')

# Create a fixed-step tiling of frequencies from 1 to 40 Hz in steps of 1 Hz
freqs = np.arange(10., 60., 1.)
dpls_beta[0].plot_tfr_morlet(freqs, n_cycles=7, ax=axes[3], show=False)
plt.show()
    </code>
</div>
<div class='markdown-cell'>
    <p>Next we will inspect what happens when a sensory stimulus is
delivered 75 ms after a beta event. Note that the delay time for a
tactile stimulus at the hand to arrive at the cortex is roughly 25 ms,
which means the first proximal input to the cortical column occurs ~100
ms after the beta event.</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        dpls_beta_erp[0].smooth(45)
fig, axes = plt.subplots(3, 1, sharex=True, figsize=(7, 7),
                         constrained_layout=True)
plot_dipole(dpls_beta_erp, ax=axes[0], layer='agg', tmin=1.0, color='r',
            show=False)
axes[0].set_title('Beta Event + ERP')
net_beta_erp.cell_response.plot_spikes_hist(ax=axes[1], show=False)
axes[1].set_title('Input Drives Histogram')
net_beta_erp.cell_response.plot_spikes_raster(ax=axes[2], show=False)
axes[2].set_title('Spike Raster')
plt.show()
    </code>
</div>
<div class='markdown-cell'>
    <p>To help understand the effect of beta mediated inhibition on the
response to incoming sensory stimuli, we can compare the ERP and spiking
activity due to sensory input with and without a beta event. The
sustained inhibition of the network ultimately depresses the sensory
response which is associated with a reduced ERP amplitude</p>

</div>
<div class='code-cell'>
    <code class='language-python'>
        dpls_erp[0].smooth(45)
fig, axes = plt.subplots(3, 1, sharex=True, figsize=(7, 7),
                         constrained_layout=True)
plot_dipole(dpls_beta_erp, ax=axes[0], layer='agg', tmin=1.0, color='r',
            show=False)
plot_dipole(dpls_erp, ax=axes[0], layer='agg', tmin=1.0, color='b', show=False)
axes[0].set_title('Beta ERP Comparison')
axes[0].legend(['ERP + Beta', 'ERP'])
net_beta_erp.cell_response.plot_spikes_raster(ax=axes[1], show=False)
axes[1].set_title('Beta + ERP Spike Raster')
net_erp.cell_response.plot_spikes_raster(ax=axes[2], show=False)
axes[2].set_title('ERP Spike Raster')
plt.show()
    </code>
</div><div class='markdown-cell'>
    <h2>References</h2>
<ul>
<li><p>Jones, Stephanie R., Dominique L. Pritchett, Michael A. Sikora,
Steven M. Stufflebeam, Matti Hämäläinen, and Christopher I. Moore. 2009.
“Quantitative Analysis and Biophysically Realistic Neural Modeling of
the MEG Mu Rhythm: Rhythmogenesis and Modulation of Sensory-Evoked
Responses.” Journal of Neurophysiology 102 (6): 3554–72. <a
href="https://doi.org/10.1152/jn.00535.2009">https://doi.org/10.1152/jn.00535.2009</a>
.</p></li>
<li><p>Law, Robert G., Sarah Pugliese, Hyeyoung Shin, Danielle D. Sliva,
Shane Lee, Samuel Neymotin, Christopher Moore, and Stephanie R. Jones.
2021. “Thalamocortical Mechanisms Regulating the Relationship between
Transient Beta Events and Human Tactile Perception.” bioRxiv. <a
href="https://doi.org/10.1101/2021.04.16.440210">https://doi.org/10.1101/2021.04.16.440210</a>.</p></li>
<li><p>Silberberg, Gilad, and Henry Markram. 2007. “Disynaptic
Inhibition between Neocortical Pyramidal Cells Mediated by Martinotti
Cells.” Neuron 53 (5): 735–46. <a
href="https://doi.org/10.1016/j.neuron.2007.02.012">https://doi.org/10.1016/j.neuron.2007.02.012</a>.</p></li>
</ul>

</div>
        <!-- footer area -->
        <!----------------->
        <div class="footer-area">
            <div class="previous-area" data-link="/website_redesign/content/09_feature_demos/batch_simulation.html">
                <div class="previous-icon">
                    <svg class="svg-arrow" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path class="arrow-path" d="M15 5L9 12L15 19" />
                    </svg>
                </div>
                <div class="previous-text">
                    <p>Previous</p>
                    <a>7.5 Batch Simulation</a>
                </div>
            </div>
            <div class="next-area" data-link="/website_redesign/content/09_feature_demos/use_mpi_backend_for_parallelization.html">
                <div class="next-text">
                    <p>Next</p>
                    <a>7.7 Use MPI Backend for Parallelization</a>
                </div>
                <div class="next-icon">
                    <svg class="svg-arrow" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path class="arrow-path" d="M15 5L9 12L15 19" />
                    </svg>
                </div>
            </div>
        </div> <!-- close footer -->
    </div> <!-- close content -->
    </div> <!-- close content wrapper -->
</div> <!-- close main -->
<script>
    // ----------------------------------------
    // Manage footer
    // ----------------------------------------
    // This function will update the footer links when a page is loaded
    // locally so that naivagation remains functional without a server
    // Note: this solution is specific to MacOS
    document.addEventListener("DOMContentLoaded", function() {
        if (window.location.protocol === "file:") {
            // Get the current local directory path
            const currentDir = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'));

            // Process both previous and next links
            document.querySelectorAll('.previous-area, .next-area').forEach(function(area) {
                const link = area.getAttribute('data-link');
                
                if (link && link.startsWith("/")) {
                    // Extract the local root directory
                    const rootPath = currentDir.split("/website_redesign/")[0];
                    // Prepend root path to link
                    const resolvedLink = "file://" + rootPath + link;
                    area.setAttribute("data-link", resolvedLink);
                }
            });
        }
    });
    // Hide the area if data-link is 'None'
    document.querySelectorAll('.previous-area, .next-area').forEach(function(area) {
        if (area.getAttribute('data-link') === 'None') {
            area.style.display = 'none'; 
        }
    });

    // Redirect to the specified link
    document.querySelectorAll('.previous-area, .next-area').forEach(function(area) {
        area.addEventListener('click', function() {
            window.location.href = area.getAttribute('data-link');
        });
    });

    // ----------------------------------------
    // Manage sidebar
    // ----------------------------------------
    let isSidebarOpen = true; // Sidebar is initially open
    let isSidebarFullyOpen = true; // Sidebar is fully open
    const maxWidth = '350px';

    function toggleNav() {
        const sidebar = document.getElementById("mySidebar");
        const main = document.getElementById("main");

        // Toggle sidebar state
        if (isSidebarOpen) {
            sidebar.style.width = "0";
            main.style.marginLeft = "0";
            isSidebarFullyOpen = false;
        } else {
            sidebar.style.width = maxWidth;
            main.style.marginLeft = maxWidth;  // Match margin to new width
        }

        // Toggle the sidebar state
        isSidebarOpen = !isSidebarOpen;

        // Store the sidebar state in localStorage
        localStorage.setItem("sidebarState", isSidebarOpen ? "open" : "closed");
    }

    // Always listen for the transitionend on the sidebar
    const sidebar = document.getElementById("mySidebar");
    sidebar.addEventListener('transitionend', function() {
        if (sidebar.style.width === maxWidth) {
            // Sidebar has fully opened
            isSidebarFullyOpen = true;
        } else {
            // Sidebar is not fully open
            isSidebarFullyOpen = false;
        }
    });

    // Open the sidebar on page load
    // -----------------------------
    window.onload = function() {
        const sidebar = document.getElementById("mySidebar");
        const main = document.getElementById("main");

        // Retrieve stored state
        const savedState = localStorage.getItem("sidebarState");

        // Determine initial state
        if (savedState === "closed") {
            sidebar.style.width = "0";
            main.style.marginLeft = "0";
            isSidebarOpen = false;
            isSidebarFullyOpen = false;
        } else {
            sidebar.style.width = maxWidth;
            main.style.marginLeft = maxWidth;
            isSidebarOpen = true;
            isSidebarFullyOpen = true;
        }

        // Disable transition for the initial state
        sidebar.style.transition = "none";
        main.style.transition = "none";

        // Re-enable transition for subsequent toggles
        setTimeout(() => {
            sidebar.style.transition = "width 0.5s";
            main.style.transition = "margin-left 0.5s";
        }, 10);
    }

    function toggleSubmenu(event) {
        const header = event.target.closest('#sidebar-header'); // Get the clicked header
        const submenu = header.nextElementSibling; // Get the submenu
        const toggleIcon = header.querySelector('.toggle-icon'); // Get the icon

        if (submenu && submenu.classList.contains('submenu')) {
            submenu.classList.toggle('open'); // Toggle the 'open' class to control visibility
            toggleIcon.textContent = submenu.classList.contains('open') ? '-' : '+'; // Update icon
        }
    }

    // Resolve sidebar links for local development
    // -------------------------------------------
    // This function will update the sidebar links when a page is loaded
    // locally so that sidebar naivagation remains functional without a server
    // Note: this solution is specific to MacOS
    document.addEventListener("DOMContentLoaded", function() {
        if (window.location.protocol === "file:") {
            // get the current local directory path
            const currentDir = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'));

            // get 'absolute' links with root of 'website_redesign'
            const links = document.querySelectorAll("#mySidebar a");
            links.forEach(link => {
                const href = link.getAttribute("href");

                if (href && href.startsWith("/")) {
                    // extract the local root directory
                    const rootPath = currentDir.split("/website_redesign/")[0];
                    // prepend root path to link
                    const resolvedHref = "file://" + rootPath + href;
                    link.setAttribute("href", resolvedHref);
                }
            });

            // Update image sources for icons
            const images = document.querySelectorAll(".social-icons img, .menu-icons img");
            images.forEach(img => {
                const src = img.getAttribute("src");

                if (src && src.startsWith("/")) {
                    // extract the local root directory
                    const rootPath = currentDir.split("/website_redesign/")[0];
                    // prepend root path to image source
                    const resolvedSrc = "file://" + rootPath + src;
                    img.setAttribute("src", resolvedSrc);
                }
            });
        }
    });

    // Custom tooltips for the sidebar
    // -------------------------------
    // Flag to track tooltip visibility
    let isTooltipVisible = false;

    // Add text to the 'sidebar-tooltip' attribute for sidebar anchor tags
    document.querySelectorAll('.sidebar a').forEach(anchor => {
        const cleanedText = anchor.textContent.replace(/[+\-]/g, '').trim();
        anchor.setAttribute('sidebar-tooltip', cleanedText);
    });

    // Handle sidebar tooltips
    document.querySelectorAll('.sidebar a').forEach(function(link) {
        link.addEventListener('mouseenter', function(event) {
            const tooltipText = event.target.getAttribute('sidebar-tooltip');
            
            if (!tooltipText || isTooltipVisible || !isSidebarFullyOpen) return; // Only show tooltip if none is visible

            // Check if the text is overflowing
            if (event.target.scrollWidth > event.target.offsetWidth) {
                const delay = 500; // Set the delay time (in ms), adjust as needed

                // Create the tooltip after the delay
                setTimeout(function() {
                    // Remove any existing tooltips
                    const existingTooltip = document.querySelector('.sidebar-tooltip');
                    if (existingTooltip) {
                        existingTooltip.remove();
                    }

                    // Create the tooltip element dynamically
                    const tooltip = document.createElement('div');
                    tooltip.classList.add('sidebar-tooltip');  // Use the existing class
                    tooltip.innerText = tooltipText;

                    // Append the tooltip to the sidebar container
                    const sidebarContainer = document.querySelector('.sidebar');
                    sidebarContainer.appendChild(tooltip);

                    // Get the position of the link and the sidebar container
                    const rect = event.target.getBoundingClientRect();
                    const sidebarRect = sidebarContainer.getBoundingClientRect();

                    // Position the tooltip relative to the sidebar container
                    tooltip.style.position = 'absolute';
                    tooltip.style.left = `${rect.left - sidebarRect.left + sidebarContainer.scrollLeft + 20}px`;
                    tooltip.style.top = `${rect.bottom - sidebarRect.top + sidebarContainer.scrollTop + 5}px`;

                    // Make sure the tooltip is visible
                    tooltip.style.opacity = '1';

                    // Set the flag to true indicating that the tooltip is visible
                    isTooltipVisible = true;
                }, delay); // Delay the tooltip creation
            }
        });

        link.addEventListener('mouseleave', function(event) {
            // Remove the tooltip when the mouse leaves
            const tooltip = document.querySelector('.sidebar-tooltip');
            if (tooltip) {
                tooltip.remove();
            }

            // Reset the flag to false when the tooltip is removed
            isTooltipVisible = false;
        });
    });

    // Close all open submenus in the sidebar
    // --------------------------------------
    document.addEventListener("DOMContentLoaded", function() {
        // Function to close all open submenus in the navbar
        function closeAllSubmenus() {
            const allSubmenus = document.querySelectorAll('.submenu.open'); // Select all open submenus
            allSubmenus.forEach(submenu => {
                submenu.classList.remove('open'); // Remove 'open' class to collapse
                const toggleIcon = submenu.previousElementSibling.querySelector('.toggle-icon');
                if (toggleIcon) {
                    toggleIcon.textContent = '+'; // Reset icon to '+'
                }
            });
        }

        // Add functionality to collapse button (SVG icon)
        const collapseIcon = document.querySelector('.collapse-icon');
        if (collapseIcon) {
            collapseIcon.addEventListener('click', function(event) {
                event.stopPropagation(); // Prevent event propagation to avoid unwanted behavior
                closeAllSubmenus(); // Close all open submenus when the icon is clicked
            });
        }
    });

    // Keep the current page open in the sidebar
    // -----------------------------------------
    document.addEventListener("DOMContentLoaded", function () {
        // Get the full path relative to the 'content' folder
        const currentPage = window.location.pathname.split("/content/")[1].split("?")[0];

        // Find the active link using the full path
        const activeLink = document.querySelector(`#mySidebar a[href$='${currentPage}']`);

        if (activeLink) {
            // Apply the active class
            activeLink.classList.add("active");
             // Find the closest submenu
            const submenu = activeLink.closest('.submenu');

            if (submenu) {
                // Keep the submenu open
                submenu.classList.add('open');
                const toggleIcon = submenu.previousElementSibling.querySelector('.toggle-icon');

                if (toggleIcon) {
                    // Ensure the toggle icon reflects the open state
                    toggleIcon.textContent = '-';
                }
            }
        }
    });

    // ------------------------------
    // Font size buttons and dropdown
    // ------------------------------
    document.addEventListener("DOMContentLoaded", function() {
        const content = document.getElementById("content");

        // Retrieve and apply the saved font size
        const savedFontSize = localStorage.getItem("fontSize");
        if (savedFontSize && content) {
            content.style.fontSize = savedFontSize + "px";
        }
    });

    function increaseFontSize() {
        event.stopPropagation();  // Prevent dropdown from closing
        const content = document.getElementById("content");
        const currentSize = parseFloat(window.getComputedStyle(content).fontSize);
        const newSize = currentSize + 1;

        content.style.fontSize = newSize + "px";

        // save font size to localStorage
        localStorage.setItem("fontSize", newSize);
    }

    function decreaseFontSize() {
        event.stopPropagation();  // Prevent dropdown from closing
        const content = document.getElementById("content");
        const currentSize = parseFloat(window.getComputedStyle(content).fontSize);
        const newSize = currentSize - 1;

        content.style.fontSize = newSize + "px";

        // save font size to localStorage
        localStorage.setItem("fontSize", newSize);
    }

    // Dropdown for font buttons
    function toggleDropdown() {
        const dropdownContent = document.querySelector('.dropdown-content');
        dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
    }

    // Open/close dropdown on click of the button
    document.getElementById('dropdownButton').onclick = function(event) {
        event.stopPropagation();  // Prevent the click from triggering the window.onclick event
        toggleDropdown();
    };

    // Close dropdown if clicking outside
    window.onclick = function(event) {
        const dropdownContent = document.querySelector('.dropdown-content');
        if (!event.target.closest('.dropdown')) {  // Close if click outside the dropdown
            dropdownContent.style.display = 'none';
        }
    };

    // ----------------------------------------
    // Toggle between light and dark themes
    // ----------------------------------------
    // Wait for the DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', () => {
        const themeToggle = document.querySelector('.theme-toggle');
        const sidebar = document.querySelector('.sidebar');
        const sunSVG = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"></path>
            </svg>
        `;
        const moonSVG = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                <path d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"></path>
            </svg>
        `;

        // Check the saved theme preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.body.classList.toggle('dark-mode', savedTheme === 'dark');
            themeToggle.innerHTML = savedTheme === 'dark' ? moonSVG : sunSVG;
            sidebar.classList.toggle('dark-mode', savedTheme === 'dark');
        } else {
            // Default to light theme if no saved preference
            themeToggle.innerHTML = sunSVG;
        }

        // Add click event to toggle theme
        themeToggle.addEventListener('click', () => {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            themeToggle.innerHTML = isDarkMode ? moonSVG : sunSVG;
            sidebar.classList.toggle('dark-mode', isDarkMode);
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        });
    });

</script>

<!------------------------ #
# Code syntax highlighting #
# ------------------------->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />

<script>
    // Remove the leading whitespace/newlines around code blocks 
    // caused by the html structure used for readability
    document.addEventListener("DOMContentLoaded", function() {
        // Select all code blocks
        const codeBlocks = document.querySelectorAll('.code-cell code.language-python');

        codeBlocks.forEach(function(block) {
            // Apply syntax highlighting to the code block
            // Note: The below line is not needed with this setup
            //  but may be useful in the case that the method
            //  is later changed
            // Prism.highlightElement(block);

            // Get the code with highlighted classes
            const highlightedHTML = block.innerHTML;

            // Remove leading/trailing whitespace/newlines
            block.innerHTML = highlightedHTML.trim();
        });

        // Select all output-code blocks
        const outputBlocks = document.querySelectorAll('.output-cell .output-code');

        outputBlocks.forEach(function(block) {
            // Remove unwanted leading/trailing whitespace or newlines
            block.textContent = block.textContent.trim();
        });
    });

</script>

</body>
</html>